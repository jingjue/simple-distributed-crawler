{"remainingRequest":"D:\\Project\\spiderPlatform\\spider_platform\\node_modules\\babel-loader\\lib\\index.js!D:\\Project\\spiderPlatform\\spider_platform\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\Project\\spiderPlatform\\spider_platform\\src\\router\\guards.js","dependencies":[{"path":"D:\\Project\\spiderPlatform\\spider_platform\\src\\router\\guards.js","mtime":1646988546878},{"path":"D:\\Project\\spiderPlatform\\spider_platform\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1646988157970},{"path":"D:\\Project\\spiderPlatform\\spider_platform\\node_modules\\babel-loader\\lib\\index.js","mtime":1646988157969},{"path":"D:\\Project\\spiderPlatform\\spider_platform\\node_modules\\eslint-loader\\index.js","mtime":1646988172536}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0IHsgaGFzQXV0aG9yaXR5IH0gZnJvbSAnQC91dGlscy9hdXRob3JpdHktdXRpbHMnOwppbXBvcnQgeyBsb2dpbklnbm9yZSB9IGZyb20gJ0Avcm91dGVyL2luZGV4JzsKaW1wb3J0IHsgY2hlY2tBdXRob3JpemF0aW9uIH0gZnJvbSAnQC91dGlscy9yZXF1ZXN0JzsKaW1wb3J0IE5Qcm9ncmVzcyBmcm9tICducHJvZ3Jlc3MnOwpOUHJvZ3Jlc3MuY29uZmlndXJlKHsKICBzaG93U3Bpbm5lcjogZmFsc2UKfSk7Ci8qKg0KICog6L+b5bqm5p2h5byA5aeLDQogKiBAcGFyYW0gdG8NCiAqIEBwYXJhbSBmb3JtDQogKiBAcGFyYW0gbmV4dA0KICovCgp2YXIgcHJvZ3Jlc3NTdGFydCA9IGZ1bmN0aW9uIHByb2dyZXNzU3RhcnQodG8sIGZyb20sIG5leHQpIHsKICAvLyBzdGFydCBwcm9ncmVzcyBiYXIKICBpZiAoIU5Qcm9ncmVzcy5pc1N0YXJ0ZWQoKSkgewogICAgTlByb2dyZXNzLnN0YXJ0KCk7CiAgfQoKICBuZXh0KCk7Cn07Ci8qKg0KICog55m75b2V5a6I5Y2rDQogKiBAcGFyYW0gdG8NCiAqIEBwYXJhbSBmb3JtDQogKiBAcGFyYW0gbmV4dA0KICogQHBhcmFtIG9wdGlvbnMNCiAqLwoKCnZhciBsb2dpbkd1YXJkID0gZnVuY3Rpb24gbG9naW5HdWFyZCh0bywgZnJvbSwgbmV4dCwgb3B0aW9ucykgewogIHZhciBtZXNzYWdlID0gb3B0aW9ucy5tZXNzYWdlOwoKICBpZiAoIWxvZ2luSWdub3JlLmluY2x1ZGVzKHRvKSAmJiAhY2hlY2tBdXRob3JpemF0aW9uKCkpIHsKICAgIG1lc3NhZ2Uud2FybmluZygn55m75b2V5bey5aSx5pWI77yM6K+36YeN5paw55m75b2VJyk7CiAgICBuZXh0KHsKICAgICAgcGF0aDogJy9sb2dpbicKICAgIH0pOwogIH0gZWxzZSB7CiAgICBuZXh0KCk7CiAgfQp9OwovKioNCiAqIOadg+mZkOWuiOWNqw0KICogQHBhcmFtIHRvDQogKiBAcGFyYW0gZm9ybQ0KICogQHBhcmFtIG5leHQNCiAqIEBwYXJhbSBvcHRpb25zDQogKi8KCgp2YXIgYXV0aG9yaXR5R3VhcmQgPSBmdW5jdGlvbiBhdXRob3JpdHlHdWFyZCh0bywgZnJvbSwgbmV4dCwgb3B0aW9ucykgewogIHZhciBzdG9yZSA9IG9wdGlvbnMuc3RvcmUsCiAgICAgIG1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2U7CiAgdmFyIHBlcm1pc3Npb25zID0gc3RvcmUuZ2V0dGVyc1snYWNjb3VudC9wZXJtaXNzaW9ucyddOwogIHZhciByb2xlcyA9IHN0b3JlLmdldHRlcnNbJ2FjY291bnQvcm9sZXMnXTsKCiAgaWYgKCFoYXNBdXRob3JpdHkodG8sIHBlcm1pc3Npb25zLCByb2xlcykpIHsKICAgIG1lc3NhZ2Uud2FybmluZygiXHU1QkY5XHU0RTBEXHU4RDc3XHVGRjBDXHU2MEE4XHU2NUUwXHU2NzQzXHU4QkJGXHU5NUVFXHU5ODc1XHU5NzYyOiAiLmNvbmNhdCh0by5mdWxsUGF0aCwgIlx1RkYwQ1x1OEJGN1x1ODA1NFx1N0NGQlx1N0JBMVx1NzQwNlx1NTQ1OCIpKTsKICAgIG5leHQoewogICAgICBwYXRoOiAnLzQwMycKICAgIH0pOyAvLyBOUHJvZ3Jlc3MuZG9uZSgpCiAgfSBlbHNlIHsKICAgIG5leHQoKTsKICB9Cn07Ci8qKg0KICog5re35ZCI5a+86Iiq5qih5byP5LiL5LiA57qn6I+c5Y2V6Lez6L2s6YeN5a6a5ZCRDQogKiBAcGFyYW0gdG8NCiAqIEBwYXJhbSBmcm9tDQogKiBAcGFyYW0gbmV4dA0KICogQHBhcmFtIG9wdGlvbnMNCiAqIEByZXR1cm5zIHsqfQ0KICovCgoKdmFyIHJlZGlyZWN0R3VhcmQgPSBmdW5jdGlvbiByZWRpcmVjdEd1YXJkKHRvLCBmcm9tLCBuZXh0LCBvcHRpb25zKSB7CiAgdmFyIHN0b3JlID0gb3B0aW9ucy5zdG9yZTsKCiAgdmFyIGdldEZpcnN0Q2hpbGQgPSBmdW5jdGlvbiBnZXRGaXJzdENoaWxkKHJvdXRlcykgewogICAgdmFyIHJvdXRlID0gcm91dGVzWzBdOwoKICAgIGlmICghcm91dGUuY2hpbGRyZW4gfHwgcm91dGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiByb3V0ZTsKICAgIH0KCiAgICByZXR1cm4gZ2V0Rmlyc3RDaGlsZChyb3V0ZS5jaGlsZHJlbik7CiAgfTsKCiAgaWYgKHN0b3JlLnN0YXRlLnNldHRpbmcubGF5b3V0ID09PSAnbWl4JykgewogICAgdmFyIGZpcnN0TWVudSA9IHN0b3JlLmdldHRlcnNbJ3NldHRpbmcvZmlyc3RNZW51J107CgogICAgaWYgKGZpcnN0TWVudS5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIHJldHVybiBpdGVtLmZ1bGxQYXRoID09PSB0by5mdWxsUGF0aDsKICAgIH0pKSB7CiAgICAgIHN0b3JlLmNvbW1pdCgnc2V0dGluZy9zZXRBY3RpdmF0ZWRGaXJzdCcsIHRvLmZ1bGxQYXRoKTsKICAgICAgdmFyIHN1Yk1lbnUgPSBzdG9yZS5nZXR0ZXJzWydzZXR0aW5nL3N1Yk1lbnUnXTsKCiAgICAgIGlmIChzdWJNZW51Lmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgcmVkaXJlY3QgPSBnZXRGaXJzdENoaWxkKHN1Yk1lbnUpOwogICAgICAgIHJldHVybiBuZXh0KHsKICAgICAgICAgIHBhdGg6IHJlZGlyZWN0LmZ1bGxQYXRoCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9CgogIG5leHQoKTsKfTsKLyoqDQogKiDov5vluqbmnaHnu5PmnZ8NCiAqIEBwYXJhbSB0bw0KICogQHBhcmFtIGZvcm0NCiAqIEBwYXJhbSBvcHRpb25zDQogKi8KCgp2YXIgcHJvZ3Jlc3NEb25lID0gZnVuY3Rpb24gcHJvZ3Jlc3NEb25lKCkgewogIC8vIGZpbmlzaCBwcm9ncmVzcyBiYXIKICBOUHJvZ3Jlc3MuZG9uZSgpOwp9OwoKZXhwb3J0IGRlZmF1bHQgewogIGJlZm9yZUVhY2g6IFtwcm9ncmVzc1N0YXJ0LCBsb2dpbkd1YXJkLCBhdXRob3JpdHlHdWFyZCwgcmVkaXJlY3RHdWFyZF0sCiAgYWZ0ZXJFYWNoOiBbcHJvZ3Jlc3NEb25lXQp9Ow=="},{"version":3,"sources":["D:/Project/spiderPlatform/spider_platform/src/router/guards.js"],"names":["hasAuthority","loginIgnore","checkAuthorization","NProgress","configure","showSpinner","progressStart","to","from","next","isStarted","start","loginGuard","options","message","includes","warning","path","authorityGuard","store","permissions","getters","roles","fullPath","redirectGuard","getFirstChild","routes","route","children","length","state","setting","layout","firstMenu","find","item","commit","subMenu","redirect","progressDone","done","beforeEach","afterEach"],"mappings":";;;AAAA,SAAQA,YAAR,QAA2B,yBAA3B;AACA,SAAQC,WAAR,QAA0B,gBAA1B;AACA,SAAQC,kBAAR,QAAiC,iBAAjC;AACA,OAAOC,SAAP,MAAsB,WAAtB;AAEAA,SAAS,CAACC,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB;AAEA;;;;;;;AAMA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAoB;AACxC;AACA,MAAI,CAACN,SAAS,CAACO,SAAV,EAAL,EAA4B;AAC1BP,IAAAA,SAAS,CAACQ,KAAV;AACD;;AACDF,EAAAA,IAAI;AACL,CAND;AAQA;;;;;;;;;AAOA,IAAMG,UAAU,GAAG,SAAbA,UAAa,CAACL,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAiBI,OAAjB,EAA6B;AAAA,MACvCC,OADuC,GAC5BD,OAD4B,CACvCC,OADuC;;AAE9C,MAAI,CAACb,WAAW,CAACc,QAAZ,CAAqBR,EAArB,CAAD,IAA6B,CAACL,kBAAkB,EAApD,EAAwD;AACtDY,IAAAA,OAAO,CAACE,OAAR,CAAgB,aAAhB;AACAP,IAAAA,IAAI,CAAC;AAACQ,MAAAA,IAAI,EAAE;AAAP,KAAD,CAAJ;AACD,GAHD,MAGO;AACLR,IAAAA,IAAI;AACL;AACF,CARD;AAUA;;;;;;;;;AAOA,IAAMS,cAAc,GAAG,SAAjBA,cAAiB,CAACX,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAiBI,OAAjB,EAA6B;AAAA,MAC3CM,KAD2C,GACzBN,OADyB,CAC3CM,KAD2C;AAAA,MACpCL,OADoC,GACzBD,OADyB,CACpCC,OADoC;AAElD,MAAMM,WAAW,GAAGD,KAAK,CAACE,OAAN,CAAc,qBAAd,CAApB;AACA,MAAMC,KAAK,GAAGH,KAAK,CAACE,OAAN,CAAc,eAAd,CAAd;;AACA,MAAI,CAACrB,YAAY,CAACO,EAAD,EAAKa,WAAL,EAAkBE,KAAlB,CAAjB,EAA2C;AACzCR,IAAAA,OAAO,CAACE,OAAR,+EAAgCT,EAAE,CAACgB,QAAnC;AACAd,IAAAA,IAAI,CAAC;AAACQ,MAAAA,IAAI,EAAE;AAAP,KAAD,CAAJ,CAFyC,CAGzC;AACD,GAJD,MAIO;AACLR,IAAAA,IAAI;AACL;AACF,CAXD;AAaA;;;;;;;;;;AAQA,IAAMe,aAAa,GAAG,SAAhBA,aAAgB,CAACjB,EAAD,EAAKC,IAAL,EAAWC,IAAX,EAAiBI,OAAjB,EAA6B;AAAA,MAC1CM,KAD0C,GACjCN,OADiC,CAC1CM,KAD0C;;AAEjD,MAAMM,aAAa,GAAG,SAAhBA,aAAgB,CAACC,MAAD,EAAY;AAChC,QAAMC,KAAK,GAAGD,MAAM,CAAC,CAAD,CAApB;;AACA,QAAI,CAACC,KAAK,CAACC,QAAP,IAAmBD,KAAK,CAACC,QAAN,CAAeC,MAAf,KAA0B,CAAjD,EAAoD;AAClD,aAAOF,KAAP;AACD;;AACD,WAAOF,aAAa,CAACE,KAAK,CAACC,QAAP,CAApB;AACD,GAND;;AAOA,MAAIT,KAAK,CAACW,KAAN,CAAYC,OAAZ,CAAoBC,MAApB,KAA+B,KAAnC,EAA0C;AACxC,QAAMC,SAAS,GAAGd,KAAK,CAACE,OAAN,CAAc,mBAAd,CAAlB;;AACA,QAAIY,SAAS,CAACC,IAAV,CAAe,UAAAC,IAAI;AAAA,aAAIA,IAAI,CAACZ,QAAL,KAAkBhB,EAAE,CAACgB,QAAzB;AAAA,KAAnB,CAAJ,EAA2D;AACzDJ,MAAAA,KAAK,CAACiB,MAAN,CAAa,2BAAb,EAA0C7B,EAAE,CAACgB,QAA7C;AACA,UAAMc,OAAO,GAAGlB,KAAK,CAACE,OAAN,CAAc,iBAAd,CAAhB;;AACA,UAAIgB,OAAO,CAACR,MAAR,GAAiB,CAArB,EAAwB;AACtB,YAAMS,QAAQ,GAAGb,aAAa,CAACY,OAAD,CAA9B;AACA,eAAO5B,IAAI,CAAC;AAACQ,UAAAA,IAAI,EAAEqB,QAAQ,CAACf;AAAhB,SAAD,CAAX;AACD;AACF;AACF;;AACDd,EAAAA,IAAI;AACL,CArBD;AAuBA;;;;;;;;AAMA,IAAM8B,YAAY,GAAG,SAAfA,YAAe,GAAM;AACzB;AACApC,EAAAA,SAAS,CAACqC,IAAV;AACD,CAHD;;AAKA,eAAe;AACbC,EAAAA,UAAU,EAAE,CAACnC,aAAD,EAAgBM,UAAhB,EAA4BM,cAA5B,EAA4CM,aAA5C,CADC;AAEbkB,EAAAA,SAAS,EAAE,CAACH,YAAD;AAFE,CAAf","sourcesContent":["import {hasAuthority} from '@/utils/authority-utils'\r\nimport {loginIgnore} from '@/router/index'\r\nimport {checkAuthorization} from '@/utils/request'\r\nimport NProgress from 'nprogress'\r\n\r\nNProgress.configure({ showSpinner: false })\r\n\r\n/**\r\n * 进度条开始\r\n * @param to\r\n * @param form\r\n * @param next\r\n */\r\nconst progressStart = (to, from, next) => {\r\n  // start progress bar\r\n  if (!NProgress.isStarted()) {\r\n    NProgress.start()\r\n  }\r\n  next()\r\n}\r\n\r\n/**\r\n * 登录守卫\r\n * @param to\r\n * @param form\r\n * @param next\r\n * @param options\r\n */\r\nconst loginGuard = (to, from, next, options) => {\r\n  const {message} = options\r\n  if (!loginIgnore.includes(to) && !checkAuthorization()) {\r\n    message.warning('登录已失效，请重新登录')\r\n    next({path: '/login'})\r\n  } else {\r\n    next()\r\n  }\r\n}\r\n\r\n/**\r\n * 权限守卫\r\n * @param to\r\n * @param form\r\n * @param next\r\n * @param options\r\n */\r\nconst authorityGuard = (to, from, next, options) => {\r\n  const {store, message} = options\r\n  const permissions = store.getters['account/permissions']\r\n  const roles = store.getters['account/roles']\r\n  if (!hasAuthority(to, permissions, roles)) {\r\n    message.warning(`对不起，您无权访问页面: ${to.fullPath}，请联系管理员`)\r\n    next({path: '/403'})\r\n    // NProgress.done()\r\n  } else {\r\n    next()\r\n  }\r\n}\r\n\r\n/**\r\n * 混合导航模式下一级菜单跳转重定向\r\n * @param to\r\n * @param from\r\n * @param next\r\n * @param options\r\n * @returns {*}\r\n */\r\nconst redirectGuard = (to, from, next, options) => {\r\n  const {store} = options\r\n  const getFirstChild = (routes) => {\r\n    const route = routes[0]\r\n    if (!route.children || route.children.length === 0) {\r\n      return route\r\n    }\r\n    return getFirstChild(route.children)\r\n  }\r\n  if (store.state.setting.layout === 'mix') {\r\n    const firstMenu = store.getters['setting/firstMenu']\r\n    if (firstMenu.find(item => item.fullPath === to.fullPath)) {\r\n      store.commit('setting/setActivatedFirst', to.fullPath)\r\n      const subMenu = store.getters['setting/subMenu']\r\n      if (subMenu.length > 0) {\r\n        const redirect = getFirstChild(subMenu)\r\n        return next({path: redirect.fullPath})\r\n      }\r\n    }\r\n  }\r\n  next()\r\n}\r\n\r\n/**\r\n * 进度条结束\r\n * @param to\r\n * @param form\r\n * @param options\r\n */\r\nconst progressDone = () => {\r\n  // finish progress bar\r\n  NProgress.done()\r\n}\r\n\r\nexport default {\r\n  beforeEach: [progressStart, loginGuard, authorityGuard, redirectGuard],\r\n  afterEach: [progressDone]\r\n}\r\n"]}]}