2022-05-14 09:06:10.942 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f309878f640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1177305392363606684670092713...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2f787eda30>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1177305392363606684670...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2f787eda30>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1177305392363606684670...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f785cc400>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f785cc400>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f785cc400>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2fd8040670>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2fd8040670>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2f983fa6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2f983fa6d0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14775, started daemon 139842994304768)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14775, started daemon 139842994304768)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14775, started daemon 139842994304768)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14775, started daemon 139842994304768)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14775, started daemon 139842994304768)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1177305392363606684670092713...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f30983427c0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2ff80f31f0>
             └ <sqlalchemy.orm.query.Query object at 0x7f30983427c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30384de070>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f309878f640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f309878f640>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30384de070>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f309878f640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f309878f640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f309878f640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f309878f640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1177305392363606684670092713...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2f787eda30>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1177305392363606684670...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2f787eda30>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1177305392363606684670...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f785cc400>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f785cc400>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f785cc400>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2fd8040670>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2fd8040670>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2f983fa6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2f983fa6d0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '11773053923636066846700927131712136726763015271213666408758152969502208150978522173879243537726580833097158761506312266052732677937472041148113302611 ... (10 characters truncated) ... 05567702076031354820875301895444567758860394921707843146739958945661425810259295505303638402579051515452850947775337869931642929056717527569645535792', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:06:14.038 | ERROR    | monitor.hotSpiders.people:get_title:52 - HTTPConnectionPool(host='society.people.com.cn', port=80): Max retries exceeded with url: /GB/136657/index.html (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f30b8288460>: Failed to establish a new connection: [Errno 22] Invalid argument'))
2022-05-14 09:06:29.386 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9b9f790>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4712087781166583802406065785...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2de9c84160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4712087781166583802406...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2de9c84160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4712087781166583802406...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f305843a3a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f305843a3a0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f305843a3a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31023e0bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31023e0bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30187c03a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30187c03a0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14780, started daemon 139834209507072)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14780, started daemon 139834209507072)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14780, started daemon 139834209507072)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14780, started daemon 139834209507072)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14780, started daemon 139834209507072)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4712087781166583802406065785...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f3058430b80>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f3058430340>
             └ <sqlalchemy.orm.query.Query object at 0x7f3058430b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30d8246490>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2de9b9f790>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9b9f790>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30d8246490>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2de9b9f790>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2de9b9f790>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9b9f790>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9b9f790>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4712087781166583802406065785...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2de9c84160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4712087781166583802406...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2de9c84160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4712087781166583802406...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f305843a3a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f305843a3a0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f305843a3a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31023e0bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31023e0bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30187c03a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30187c03a0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '47120877811665838024060657854755402626343855370806904614285973913062955468550910976345600175379960139449113918496482444483460332689624247476919056748 ... (10 characters truncated) ... 11123704790286353668858136046456839466452156850493212241929974643442726050763310151859991920312571209310210250235353403596615299450423690686637890157', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:06:46.630 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2dc81fbac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5730287409422253369545417650...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2e060129a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5730287409422253369545...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2e060129a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5730287409422253369545...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2dc81fbb50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2dc81fbb50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2dc81fbb50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31f91f9d60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31f91f9d60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de9a88730>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de9a88730>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14785, started daemon 139839302301440)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14785, started daemon 139839302301440)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14785, started daemon 139839302301440)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14785, started daemon 139839302301440)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14785, started daemon 139839302301440)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5730287409422253369545417650...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f3098605eb0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2dea014a90>
             └ <sqlalchemy.orm.query.Query object at 0x7f3098605eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2de9ff6f40>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2dc81fbac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2dc81fbac0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2de9ff6f40>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2dc81fbac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2dc81fbac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2dc81fbac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2dc81fbac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5730287409422253369545417650...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2e060129a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5730287409422253369545...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2e060129a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5730287409422253369545...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2dc81fbb50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2dc81fbb50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2dc81fbb50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31f91f9d60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31f91f9d60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de9a88730>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de9a88730>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '57302874094222533695454176502112095048265148990504633416242699034813886755128441822000639910611946361962314538528985062647591533005129982416284020845 ... (10 characters truncated) ... 01198966917027507059401854274665282344239357838044022780749972489952735195107604323552797041573784126532011368548644466838675045615239116172294839872', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:07:04.857 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9c84be0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8340750430137704545408373543...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f31022bbca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8340750430137704545408...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f31022bbca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8340750430137704545408...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2fb8719b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2fb8719b50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2fb8719b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2f7817c850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2f7817c850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30d83d33d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30d83d33d0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14789, started daemon 139836264142592)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14789, started daemon 139836264142592)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14789, started daemon 139836264142592)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14789, started daemon 139836264142592)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14789, started daemon 139836264142592)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8340750430137704545408373543...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2de9c84eb0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2de9c84f40>
             └ <sqlalchemy.orm.query.Query object at 0x7f2de9c84eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30b8209520>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2de9c84be0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9c84be0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30b8209520>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2de9c84be0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2de9c84be0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9c84be0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9c84be0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8340750430137704545408373543...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f31022bbca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8340750430137704545408...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f31022bbca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8340750430137704545408...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2fb8719b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2fb8719b50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2fb8719b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2f7817c850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2f7817c850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30d83d33d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30d83d33d0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '83407504301377045454083735431097617292024577701750523435768682727374569074196911360945997613334909281746920624662516123112635308043404802621436686766 ... (10 characters truncated) ... 24757083162418156781862727093510924484815524094166736071826044296817791846130640243972801383221257874280286745757686754604378726638932999465419775735', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:07:23.954 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2e06064130>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8540261961431975926923044318...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30d827e8e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8540261961431975926923...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30d827e8e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8540261961431975926923...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f982bce50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f982bce50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f982bce50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30382558e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30382558e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f3018621bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f3018621bb0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14793, started daemon 139840301033216)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14793, started daemon 139840301033216)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14793, started daemon 139840301033216)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14793, started daemon 139840301033216)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14793, started daemon 139840301033216)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8540261961431975926923044318...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2e06064ca0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2e06064370>
             └ <sqlalchemy.orm.query.Query object at 0x7f2e06064ca0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30d827e850>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2e06064130>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2e06064130>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30d827e850>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2e06064130>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2e06064130>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2e06064130>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2e06064130>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8540261961431975926923044318...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30d827e8e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8540261961431975926923...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30d827e8e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8540261961431975926923...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f982bce50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f982bce50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f982bce50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30382558e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30382558e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f3018621bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f3018621bb0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '85402619614319759269230443185046739785063584900201148895865376921110415792456126905464693303947587745227484548240433587775411921829652961343962192264 ... (10 characters truncated) ... 89697997751111017089516236859040964095549068203764948961069291505809760419893878537160032893204709930414051405835026052615756959921988800871021964055', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:07:40.580 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb869aa00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8226555908709978988487412052...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30980873a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8226555908709978988487...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30980873a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8226555908709978988487...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f787b81c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f787b81c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f787b81c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30580c76a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30580c76a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f301817c760>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f301817c760>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14798, started daemon 139847809357568)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14798, started daemon 139847809357568)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14798, started daemon 139847809357568)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14798, started daemon 139847809357568)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14798, started daemon 139847809357568)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8226555908709978988487412052...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2fb869ae80>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2fb869afa0>
             └ <sqlalchemy.orm.query.Query object at 0x7f2fb869ae80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f301807dc70>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2fb869aa00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb869aa00>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f301807dc70>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2fb869aa00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2fb869aa00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb869aa00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb869aa00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8226555908709978988487412052...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30980873a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8226555908709978988487...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30980873a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8226555908709978988487...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f787b81c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f787b81c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f787b81c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30580c76a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30580c76a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f301817c760>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f301817c760>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '82265559087099789884874120522501215273489151793614642479955503617097131140682768355803810386098756232177684175526596177280097516025154331829179165226 ... (10 characters truncated) ... 38848788522454419276400073442978484872366404496600541234968528479326734478269800106239781892598551841724402773404297859167154545995646447252740910635', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:07:58.734 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9a9b4f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8397881689991485830473694160...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2fd854f910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8397881689991485830473...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2fd854f910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8397881689991485830473...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30180d1760>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30180d1760>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30180d1760>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2de9d36fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2de9d36fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2e11affc10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2e11affc10>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14803, started daemon 139848442009344)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14803, started daemon 139848442009344)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14803, started daemon 139848442009344)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14803, started daemon 139848442009344)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14803, started daemon 139848442009344)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8397881689991485830473694160...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2e11aff5e0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2e11ab3700>
             └ <sqlalchemy.orm.query.Query object at 0x7f2e11aff5e0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30782feb20>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2de9a9b4f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9a9b4f0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30782feb20>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2de9a9b4f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2de9a9b4f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9a9b4f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9a9b4f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8397881689991485830473694160...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2fd854f910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8397881689991485830473...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2fd854f910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8397881689991485830473...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30180d1760>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30180d1760>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30180d1760>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2de9d36fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2de9d36fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2e11affc10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2e11affc10>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '83978816899914858304736941608219575215990048520305691587962969168307631056519295630724547897994922086527849803910244562695948389231411335828397252305 ... (10 characters truncated) ... 75809487908246211598007012253242439299635621286755732059664643538595102685677744117593682900515716752078714501538225463254638416313896130034825569870', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:08:16.375 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30b878c820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7549434421602284019966624867...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2dcbff8250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7549434421602284019966...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2dcbff8250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7549434421602284019966...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2fb84b8d60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2fb84b8d60>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2fb84b8d60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31f9254160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31f9254160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2fb8484610>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2fb8484610>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14808, started daemon 139847800964864)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14808, started daemon 139847800964864)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14808, started daemon 139847800964864)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14808, started daemon 139847800964864)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14808, started daemon 139847800964864)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7549434421602284019966624867...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f30981abac0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f305841b670>
             └ <sqlalchemy.orm.query.Query object at 0x7f30981abac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30d850f580>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f30b878c820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f30b878c820>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30d850f580>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f30b878c820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f30b878c820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30b878c820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30b878c820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7549434421602284019966624867...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2dcbff8250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7549434421602284019966...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2dcbff8250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7549434421602284019966...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2fb84b8d60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2fb84b8d60>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2fb84b8d60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31f9254160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31f9254160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2fb8484610>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2fb8484610>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '75494344216022840199666248679493739281748482819167239012911600974045265127250341118961222377968174035758285072784090634296647734122629689787736239753 ... (10 characters truncated) ... 23425590737230111409779774355980006574749654783090275476613800783672218102998361216427937426251156942817838824576009856847651422376965003935061256336', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:08:34.914 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f9837adc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8848514477050754727043068960...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2de9a37f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8848514477050754727043...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2de9a37f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8848514477050754727043...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2fb83e5460>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2fb83e5460>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2fb83e5460>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30986058b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30986058b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30985bcf70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30985bcf70>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14812, started daemon 139847792572160)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14812, started daemon 139847792572160)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14812, started daemon 139847792572160)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14812, started daemon 139847792572160)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14812, started daemon 139847792572160)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8848514477050754727043068960...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f3078299dc0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f3038422190>
             └ <sqlalchemy.orm.query.Query object at 0x7f3078299dc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2de9a37e20>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2f9837adc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2f9837adc0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2de9a37e20>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2f9837adc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2f9837adc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f9837adc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f9837adc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8848514477050754727043068960...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2de9a37f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8848514477050754727043...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2de9a37f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8848514477050754727043...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2fb83e5460>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2fb83e5460>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2fb83e5460>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30986058b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30986058b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30985bcf70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30985bcf70>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '88485144770507547270430689600140588596673055258335199065344859005777786151969373899042090461334559280802578707889013328761989905449348984652027502271 ... (9 characters truncated) ... 14616281844065459291855051217265894396160121859870445440165577225546115396178402043912749158520978947393433910075351913611999451535716710713202752576', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:08:52.083 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3098543d60>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3936605199437645454358820622...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2dea0a4220>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3936605199437645454358...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2dea0a4220>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3936605199437645454358...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f309873f460>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f309873f460>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f309873f460>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31022b2b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31022b2b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2fb81e1cd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2fb81e1cd0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14816, started daemon 139847817750272)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14816, started daemon 139847817750272)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14816, started daemon 139847817750272)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14816, started daemon 139847817750272)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14816, started daemon 139847817750272)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3936605199437645454358820622...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2fb83bd0a0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f31f9320250>
             └ <sqlalchemy.orm.query.Query object at 0x7f2fb83bd0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f3101f20370>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f3098543d60>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f3098543d60>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f3101f20370>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f3098543d60>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f3098543d60>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3098543d60>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3098543d60>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3936605199437645454358820622...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2dea0a4220>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3936605199437645454358...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2dea0a4220>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3936605199437645454358...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f309873f460>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f309873f460>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f309873f460>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31022b2b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31022b2b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2fb81e1cd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2fb81e1cd0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '39366051994376454543588206222309199626283864656473485780723743404720069901376667400141947603266488288254859002122653574810136478665189287292574444088 ... (10 characters truncated) ... 90041024384882246115166776653958036169000463200757630896396625869738852926888647997769027643758580042056324596089584829478746001124449742119167919128', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:09:10.765 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f31022bbb80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1235984971959356468517827380...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2dc82d4940>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1235984971959356468517...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2dc82d4940>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1235984971959356468517...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30b8165160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30b8165160>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30b8165160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31022bbdf0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31022bbdf0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de9ab8280>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de9ab8280>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14821, started daemon 139847238915840)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14821, started daemon 139847238915840)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14821, started daemon 139847238915840)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14821, started daemon 139847238915840)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14821, started daemon 139847238915840)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1235984971959356468517827380...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f3100037d00>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2fb8719040>
             └ <sqlalchemy.orm.query.Query object at 0x7f3100037d00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2dc82d40a0>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f31022bbb80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f31022bbb80>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2dc82d40a0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f31022bbb80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f31022bbb80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f31022bbb80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f31022bbb80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1235984971959356468517827380...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2dc82d4940>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1235984971959356468517...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2dc82d4940>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1235984971959356468517...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30b8165160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30b8165160>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30b8165160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f31022bbdf0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f31022bbdf0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de9ab8280>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de9ab8280>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '12359849719593564685178273806559803664267844885849560713205603516813692993804737641295156590915384153386205441452202628602566936322214797053845851958 ... (10 characters truncated) ... 12235754506559685396372228405476912268939495836611742550662954884339787378066931944628657462969338133075636959123824306675870133692361792962789821567', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 09:09:28.245 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3098624640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5257641202656856350535732116...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30787243d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5257641202656856350535...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30787243d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5257641202656856350535...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f31002f36a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f31002f36a0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f31002f36a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2de9bf1910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2de9bf1910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f3078319730>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f3078319730>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14826, started daemon 139847272486656)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14826, started daemon 139847272486656)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14826, started daemon 139847272486656)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14826, started daemon 139847272486656)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14826, started daemon 139847272486656)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5257641202656856350535732116...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2f78685190>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f30984a5f40>
             └ <sqlalchemy.orm.query.Query object at 0x7f2f78685190>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2f98531130>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f3098624640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f3098624640>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2f98531130>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f3098624640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f3098624640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3098624640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3098624640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5257641202656856350535732116...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30787243d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5257641202656856350535...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30787243d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5257641202656856350535...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f31002f36a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f31002f36a0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f31002f36a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2de9bf1910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2de9bf1910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f3078319730>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f3078319730>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '52576412026568563505357321162645964287396632131400703648336737608163812711404039189304521389551493854542399193939839619343475557651583476283905164305 ... (10 characters truncated) ... 10173158525286539877272421259034140704621607925464975820111619507034770427736926627647517392606924938807566552858734630038201659575955271243808670149', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
