2022-05-13 16:45:13.166 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f511ffa05e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f511c3e3f70>
    └ <sqlalchemy.engine.base.Connection object at 0x7f5030164910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8325977251178848237325330665...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f511fbf5dc0>
    └ <pymysql.cursors.Cursor object at 0x7f50287c86d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8325977251178848237325...
             │    └ <function Cursor._query at 0x7f511fb80280>
             └ <pymysql.cursors.Cursor object at 0x7f50287c86d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8325977251178848237325...
    │    └ <function Connection.query at 0x7f511fb8e670>
    └ <pymysql.connections.Connection object at 0x7f50301e2250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f511fb8eca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f50301e2250>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f50301e2250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f511fb8f4c0>
    └ <pymysql.connections.MySQLResult object at 0x7f503019cd90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f503019cd90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f511fb86ee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f5030083b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f5030083b50>
    │   └ <function raise_mysql_exception at 0x7f511fc35670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f51485f1a60>
    └ <Thread(Thread-72, started daemon 139981137884928)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f51485f1790>
    └ <Thread(Thread-72, started daemon 139981137884928)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-72, started daemon 139981137884928)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-72, started daemon 139981137884928)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>>
    └ <Thread(Thread-72, started daemon 139981137884928)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f511c3f1280>
    └ <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f511c4144c0>
    │    └ <function Project.update_device_valid at 0x7f511c3ee280>
    └ <monitor.projectManager.Project object at 0x7f511c4142e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f511fb96310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f511c4144c0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f511fc9d790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f511c3e3e50>
    │    └ <base.db.dbSlot.Slot object at 0x7f511c3e3b80>
    └ <monitor.projectManager.Project object at 0x7f511c4142e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8325977251178848237325330665...
    │   └ <function Query.update at 0x7f511fddc3a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f50287cba00>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f511fdb8af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f50300fba90>
             └ <sqlalchemy.orm.query.Query object at 0x7f50287cba00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f50287c8b20>
             │    └ <function Connection._execute_20 at 0x7f5124088790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f5030164910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f5030164910>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f50287c8b20>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f51240885e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f5030164910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f51240888b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f5030164910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f5124088a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f5030164910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f512444ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f511ffa05e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f511c3e3f70>
    └ <sqlalchemy.engine.base.Connection object at 0x7f5030164910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8325977251178848237325330665...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f511fbf5dc0>
    └ <pymysql.cursors.Cursor object at 0x7f50287c86d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8325977251178848237325...
             │    └ <function Cursor._query at 0x7f511fb80280>
             └ <pymysql.cursors.Cursor object at 0x7f50287c86d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8325977251178848237325...
    │    └ <function Connection.query at 0x7f511fb8e670>
    └ <pymysql.connections.Connection object at 0x7f50301e2250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f511fb8eca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f50301e2250>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f50301e2250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f511fb8f4c0>
    └ <pymysql.connections.MySQLResult object at 0x7f503019cd90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f503019cd90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f511fb86ee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f5030083b50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f5030083b50>
    │   └ <function raise_mysql_exception at 0x7f511fc35670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '83259772511788482373253306655230342983632815533918220775166559606900308126791128821094567654407564804085325232460748485126625040633550494321092316194 ... (10 characters truncated) ... 98826889326011246139514354200780551840289114286275293540874549421253554638231830055369077223104216123991326300111326006347030582345406411592137157317', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:45:31.103 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f511ffa05e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f511c3e3f70>
    └ <sqlalchemy.engine.base.Connection object at 0x7f50300c0b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4979129638215919666475057327...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f511fbf5dc0>
    └ <pymysql.cursors.Cursor object at 0x7f50301d6f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4979129638215919666475...
             │    └ <function Cursor._query at 0x7f511fb80280>
             └ <pymysql.cursors.Cursor object at 0x7f50301d6f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4979129638215919666475...
    │    └ <function Connection.query at 0x7f511fb8e670>
    └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f511fb8eca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f511fb8f4c0>
    └ <pymysql.connections.MySQLResult object at 0x7f511c209280>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f511c209280>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f511fb86ee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f50287cb580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f50287cb580>
    │   └ <function raise_mysql_exception at 0x7f511fc35670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f51485f1a60>
    └ <Thread(Thread-76, started daemon 139981146277632)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f51485f1790>
    └ <Thread(Thread-76, started daemon 139981146277632)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-76, started daemon 139981146277632)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-76, started daemon 139981146277632)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>>
    └ <Thread(Thread-76, started daemon 139981146277632)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f511c3f1280>
    └ <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f511c4144c0>
    │    └ <function Project.update_device_valid at 0x7f511c3ee280>
    └ <monitor.projectManager.Project object at 0x7f511c4142e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f511fb96310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f511c4144c0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f511fc9d790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f511c3e3e50>
    │    └ <base.db.dbSlot.Slot object at 0x7f511c3e3b80>
    └ <monitor.projectManager.Project object at 0x7f511c4142e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4979129638215919666475057327...
    │   └ <function Query.update at 0x7f511fddc3a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f503009d670>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f511fdb8af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f503009d3a0>
             └ <sqlalchemy.orm.query.Query object at 0x7f503009d670>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f50301d6f10>
             │    └ <function Connection._execute_20 at 0x7f5124088790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f50300c0b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f50300c0b80>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f50301d6f10>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f51240885e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f50300c0b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f51240888b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f50300c0b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f5124088a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f50300c0b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f512444ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f511ffa05e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f511c3e3f70>
    └ <sqlalchemy.engine.base.Connection object at 0x7f50300c0b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4979129638215919666475057327...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f511fbf5dc0>
    └ <pymysql.cursors.Cursor object at 0x7f50301d6f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4979129638215919666475...
             │    └ <function Cursor._query at 0x7f511fb80280>
             └ <pymysql.cursors.Cursor object at 0x7f50301d6f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4979129638215919666475...
    │    └ <function Connection.query at 0x7f511fb8e670>
    └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f511fb8eca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f511fb8f4c0>
    └ <pymysql.connections.MySQLResult object at 0x7f511c209280>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f511c209280>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f511fb86ee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f50287cb580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f50287cb580>
    │   └ <function raise_mysql_exception at 0x7f511fc35670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '49791296382159196664750573278283454521163436237077401900853328973913316735458691162605485234652311796688063706499706754029995810994238808181088098919 ... (10 characters truncated) ... 00890470858778741469558779747780788041040251457076731723953723414380607301768391353150478191512055493847286399508625152942949130963957553046325817612', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:45:49.117 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f511ffa05e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f511c3e3f70>
    └ <sqlalchemy.engine.base.Connection object at 0x7f50301644f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8475965343566462882500799951...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f511fbf5dc0>
    └ <pymysql.cursors.Cursor object at 0x7f503005a400>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8475965343566462882500...
             │    └ <function Cursor._query at 0x7f511fb80280>
             └ <pymysql.cursors.Cursor object at 0x7f503005a400>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8475965343566462882500...
    │    └ <function Connection.query at 0x7f511fb8e670>
    └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f511fb8eca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f511fb8f4c0>
    └ <pymysql.connections.MySQLResult object at 0x7f50301d1e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f50301d1e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f511fb86ee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f50300c09d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f50300c09d0>
    │   └ <function raise_mysql_exception at 0x7f511fc35670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f51485f1a60>
    └ <Thread(Thread-81, started daemon 139981129492224)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f51485f1790>
    └ <Thread(Thread-81, started daemon 139981129492224)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-81, started daemon 139981129492224)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-81, started daemon 139981129492224)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>>
    └ <Thread(Thread-81, started daemon 139981129492224)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f511c3f1280>
    └ <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f511c4144c0>
    │    └ <function Project.update_device_valid at 0x7f511c3ee280>
    └ <monitor.projectManager.Project object at 0x7f511c4142e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f511fb96310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f511c4144c0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f511fc9d790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f511c3e3e50>
    │    └ <base.db.dbSlot.Slot object at 0x7f511c3e3b80>
    └ <monitor.projectManager.Project object at 0x7f511c4142e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8475965343566462882500799951...
    │   └ <function Query.update at 0x7f511fddc3a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f503005a9d0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f511fdb8af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f503005a340>
             └ <sqlalchemy.orm.query.Query object at 0x7f503005a9d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f5030123130>
             │    └ <function Connection._execute_20 at 0x7f5124088790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f50301644f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f50301644f0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f5030123130>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f51240885e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f50301644f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f51240888b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f50301644f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f5124088a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f50301644f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f512444ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f511ffa05e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f511c3e3f70>
    └ <sqlalchemy.engine.base.Connection object at 0x7f50301644f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8475965343566462882500799951...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f511fbf5dc0>
    └ <pymysql.cursors.Cursor object at 0x7f503005a400>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8475965343566462882500...
             │    └ <function Cursor._query at 0x7f511fb80280>
             └ <pymysql.cursors.Cursor object at 0x7f503005a400>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8475965343566462882500...
    │    └ <function Connection.query at 0x7f511fb8e670>
    └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f511fb8eca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f511c3f3df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f511fb8f4c0>
    └ <pymysql.connections.MySQLResult object at 0x7f50301d1e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f50301d1e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f511fb86ee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f50300c09d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f50300c09d0>
    │   └ <function raise_mysql_exception at 0x7f511fc35670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '84759653435664628825007999517271527694803832469784858628922852290796428132436759524231710993297241602333861623030297572900232007635074965534329402529 ... (10 characters truncated) ... 34117441886966293317547793611516419700840606261898734208347672473061740611712778030529420857121885906320935123336601262556716493383363799868155615024', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:46:07.111 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f511ffa05e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f511c3e3f70>
    └ <sqlalchemy.engine.base.Connection object at 0x7f5030109c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5048511960322301782187414827...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f511fbf5dc0>
    └ <pymysql.cursors.Cursor object at 0x7f50300baa60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5048511960322301782187...
             │    └ <function Cursor._query at 0x7f511fb80280>
             └ <pymysql.cursors.Cursor object at 0x7f50300baa60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5048511960322301782187...
    │    └ <function Connection.query at 0x7f511fb8e670>
    └ <pymysql.connections.Connection object at 0x7f50301e2250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f511fb8eca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f50301e2250>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f50301e2250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f511fb8f4c0>
    └ <pymysql.connections.MySQLResult object at 0x7f503024e850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f503024e850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f511fb86ee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f503004c3a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f503004c3a0>
    │   └ <function raise_mysql_exception at 0x7f511fc35670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f51485f1a60>
    └ <Thread(Thread-86, started daemon 139981154670336)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f51485f1790>
    └ <Thread(Thread-86, started daemon 139981154670336)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-86, started daemon 139981154670336)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-86, started daemon 139981154670336)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>>
    └ <Thread(Thread-86, started daemon 139981154670336)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f511c3f1280>
    └ <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f511c6d0370>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f511c4144c0>
    │    └ <function Project.update_device_valid at 0x7f511c3ee280>
    └ <monitor.projectManager.Project object at 0x7f511c4142e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f511fb96310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f511c4144c0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f511fc9d790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f511c3e3e50>
    │    └ <base.db.dbSlot.Slot object at 0x7f511c3e3b80>
    └ <monitor.projectManager.Project object at 0x7f511c4142e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5048511960322301782187414827...
    │   └ <function Query.update at 0x7f511fddc3a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f503024e9d0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f511fdb8af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f503024e3a0>
             └ <sqlalchemy.orm.query.Query object at 0x7f503024e9d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f50300badf0>
             │    └ <function Connection._execute_20 at 0x7f5124088790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f5030109c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f5030109c10>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f50300badf0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f51240885e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f5030109c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f51240888b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f5030109c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f5124088a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f5030109c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f512444ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f511ffa05e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f511c3e3f70>
    └ <sqlalchemy.engine.base.Connection object at 0x7f5030109c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5048511960322301782187414827...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f511fbf5dc0>
    └ <pymysql.cursors.Cursor object at 0x7f50300baa60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5048511960322301782187...
             │    └ <function Cursor._query at 0x7f511fb80280>
             └ <pymysql.cursors.Cursor object at 0x7f50300baa60>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5048511960322301782187...
    │    └ <function Connection.query at 0x7f511fb8e670>
    └ <pymysql.connections.Connection object at 0x7f50301e2250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f511fb8eca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f50301e2250>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f50301e2250>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f511fb8f4c0>
    └ <pymysql.connections.MySQLResult object at 0x7f503024e850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f503024e850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f511fb86ee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f503004c3a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f503004c3a0>
    │   └ <function raise_mysql_exception at 0x7f511fc35670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '50485119603223017821874148275541272679002783314461409349643933167245970627514349450015512844197536149489637369783694310478127102410148526803322939999 ... (10 characters truncated) ... 55619401047642692184758935306353250038994360219395013566992990785323489730347437633552814332108465047608386471657592676154211158871238252176883006143', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:46:31.266 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ae01ba00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2582846550494225247378999731...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ae03d100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2582846550494225247378...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ae03d100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2582846550494225247378...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12af8a8f10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12af8a8f10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ae0253d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ae0253d0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f13c792aa60>
    └ <Thread(Thread-3, started daemon 139718214244096)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f13c792a790>
    └ <Thread(Thread-3, started daemon 139718214244096)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-3, started daemon 139718214244096)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-3, started daemon 139718214244096)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f12afce7460>>
    └ <Thread(Thread-3, started daemon 139718214244096)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f12afa08280>
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    └ <function Project.update_device_valid at 0x7f12afa06280>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f139eeee310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f139eff6790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f12afa00a90>
    │    └ <base.db.dbSlot.Slot object at 0x7f12afa00ac0>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2582846550494225247378999731...
    │   └ <function Query.update at 0x7f139f1343a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f12ae01b790>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f139f110af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f12af8a84f0>
             └ <sqlalchemy.orm.query.Query object at 0x7f12ae01b790>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12ae025fd0>
             │    └ <function Connection._execute_20 at 0x7f139f3bd790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f12ae01ba00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f12ae01ba00>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12ae025fd0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f139f3bd5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f12ae01ba00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f139f3bd8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f12ae01ba00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f139f3bda60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ae01ba00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f139f77da60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ae01ba00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2582846550494225247378999731...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ae03d100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2582846550494225247378...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ae03d100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2582846550494225247378...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12af8a8f10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12af8a8f10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ae0253d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ae0253d0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '25828465504942252473789997317202969355904458520238054590648312123640193169833845173670663733744112465626774985919268650420544347037326344819605605453 ... (10 characters truncated) ... 57746965994734692798059864972754539275081703106033314318644645503339583832162891738565652267467347235220649174350168494632545994484182865535519230567', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:46:48.162 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12af8f9190>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4346915158092966556462865209...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12af880640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4346915158092966556462...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12af880640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4346915158092966556462...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12af8e3a90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12af8e3a90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ace001f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ace001f0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f13c792aa60>
    └ <Thread(Thread-8, started daemon 139718203377408)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f13c792a790>
    └ <Thread(Thread-8, started daemon 139718203377408)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-8, started daemon 139718203377408)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-8, started daemon 139718203377408)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f12afce7460>>
    └ <Thread(Thread-8, started daemon 139718203377408)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f12afa08280>
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    └ <function Project.update_device_valid at 0x7f12afa06280>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f139eeee310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f139eff6790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f12afa00a90>
    │    └ <base.db.dbSlot.Slot object at 0x7f12afa00ac0>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4346915158092966556462865209...
    │   └ <function Query.update at 0x7f139f1343a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f12af8ee100>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f139f110af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f12af89bf70>
             └ <sqlalchemy.orm.query.Query object at 0x7f12af8ee100>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12af906130>
             │    └ <function Connection._execute_20 at 0x7f139f3bd790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f12af8f9190>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f12af8f9190>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12af906130>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f139f3bd5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f12af8f9190>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f139f3bd8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f12af8f9190>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f139f3bda60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12af8f9190>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f139f77da60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12af8f9190>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4346915158092966556462865209...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12af880640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4346915158092966556462...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12af880640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4346915158092966556462...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12af8e3a90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12af8e3a90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ace001f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ace001f0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '43469151580929665564628652095582315942991001901324659634564789541804119092507374716455651616436543187553916835694148344615938427596624301448795127035 ... (10 characters truncated) ... 23769874217575115522052532030274399637324517205615437142971950917432598042215196384002952806973003476272903582805671123456564467123406398440078805618', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:47:06.168 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ade56c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4551489090026022896417069043...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ae0254f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4551489090026022896417...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ae0254f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4551489090026022896417...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12af91b580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12af91b580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12af91b5e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12af91b5e0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f13c792aa60>
    └ <Thread(Thread-13, started daemon 139718231029504)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f13c792a790>
    └ <Thread(Thread-13, started daemon 139718231029504)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-13, started daemon 139718231029504)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-13, started daemon 139718231029504)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f12afce7460>>
    └ <Thread(Thread-13, started daemon 139718231029504)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f12afa08280>
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    └ <function Project.update_device_valid at 0x7f12afa06280>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f139eeee310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f139eff6790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f12afa00a90>
    │    └ <base.db.dbSlot.Slot object at 0x7f12afa00ac0>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4551489090026022896417069043...
    │   └ <function Query.update at 0x7f139f1343a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f12ace00ca0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f139f110af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f12ace00b80>
             └ <sqlalchemy.orm.query.Query object at 0x7f12ace00ca0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12acd9e160>
             │    └ <function Connection._execute_20 at 0x7f139f3bd790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f12ade56c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f12ade56c10>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12acd9e160>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f139f3bd5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f12ade56c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f139f3bd8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f12ade56c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f139f3bda60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ade56c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f139f77da60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ade56c10>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4551489090026022896417069043...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ae0254f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4551489090026022896417...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ae0254f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4551489090026022896417...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12af91b580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12af91b580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12af91b5e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12af91b5e0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '45514890900260228964170690431256545578315727793823504556953744194645842003587333070085492557008475515717815537627751557639414975455325688710431281066 ... (7 characters truncated) ... 37761235441620597418784380252664265783793474362195213504601326505584152996444781412225450917747342159103335523721898388776697788949990741098326291412', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:47:24.160 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9aeb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4111874734297451080400494502...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12acd9ab50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4111874734297451080400...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12acd9ab50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4111874734297451080400...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12acd9ae50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12acd9ae50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12acd9ec70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12acd9ec70>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f13c792aa60>
    └ <Thread(Thread-18, started daemon 139718194984704)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f13c792a790>
    └ <Thread(Thread-18, started daemon 139718194984704)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-18, started daemon 139718194984704)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-18, started daemon 139718194984704)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f12afce7460>>
    └ <Thread(Thread-18, started daemon 139718194984704)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f12afa08280>
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    └ <function Project.update_device_valid at 0x7f12afa06280>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f139eeee310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f139eff6790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f12afa00a90>
    │    └ <base.db.dbSlot.Slot object at 0x7f12afa00ac0>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4111874734297451080400494502...
    │   └ <function Query.update at 0x7f139f1343a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f12acda63d0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f139f110af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f12acdf9a30>
             └ <sqlalchemy.orm.query.Query object at 0x7f12acda63d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12acd9a910>
             │    └ <function Connection._execute_20 at 0x7f139f3bd790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9aeb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9aeb0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12acd9a910>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f139f3bd5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9aeb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f139f3bd8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9aeb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f139f3bda60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9aeb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f139f77da60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9aeb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '4111874734297451080400494502...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12acd9ab50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4111874734297451080400...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12acd9ab50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='4111874734297451080400...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12acd9ae50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12acd9ae50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12acd9ec70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12acd9ec70>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '41118747342974510804004945020552921223957352085541959419912122600514555081555051001042821620732866238628075371975536090550053328232383943894833994792 ... (10 characters truncated) ... 50828701671126104564393267075175562389472982413061139864789146256352301518507071172235943617040675315946295527969652054058534158383741362636355800368', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:47:42.190 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9e520>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5420427280097285241733630920...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12acda6e20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5420427280097285241733...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12acda6e20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5420427280097285241733...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12ae01bdc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12ae01bdc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12acda6d30>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12acda6d30>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f13c792aa60>
    └ <Thread(Thread-22, started daemon 139717693662976)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f13c792a790>
    └ <Thread(Thread-22, started daemon 139717693662976)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-22, started daemon 139717693662976)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-22, started daemon 139717693662976)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f12afce7460>>
    └ <Thread(Thread-22, started daemon 139717693662976)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f12afa08280>
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    └ <function Project.update_device_valid at 0x7f12afa06280>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f139eeee310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f139eff6790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f12afa00a90>
    │    └ <base.db.dbSlot.Slot object at 0x7f12afa00ac0>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5420427280097285241733630920...
    │   └ <function Query.update at 0x7f139f1343a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f12acd9e220>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f139f110af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f12acd9e580>
             └ <sqlalchemy.orm.query.Query object at 0x7f12acd9e220>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12acda6820>
             │    └ <function Connection._execute_20 at 0x7f139f3bd790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9e520>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9e520>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12acda6820>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f139f3bd5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9e520>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f139f3bd8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9e520>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f139f3bda60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9e520>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f139f77da60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12acd9e520>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5420427280097285241733630920...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12acda6e20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5420427280097285241733...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12acda6e20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5420427280097285241733...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12ae01bdc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12ae01bdc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12acda6d30>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12acda6d30>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '54204272800972852417336309207531154113278782710467974682315786474292210847027665608769158949360687325555804502152313749904060632034740935591926485927 ... (10 characters truncated) ... 95159502818303777492295050454542770758182097256987516265696739653917516088656588657328461785334294282656005750041335927445312214909568049241741357017', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:48:00.153 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ac590a90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2276908560466166454956406714...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ac58e310>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2276908560466166454956...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ac58e310>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2276908560466166454956...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12ac5904c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12ac5904c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ac57c880>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ac57c880>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f13c792aa60>
    └ <Thread(Thread-26, started daemon 139717702055680)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f13c792a790>
    └ <Thread(Thread-26, started daemon 139717702055680)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-26, started daemon 139717702055680)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-26, started daemon 139717702055680)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f12afce7460>>
    └ <Thread(Thread-26, started daemon 139717702055680)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f12afa08280>
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    └ <function Project.update_device_valid at 0x7f12afa06280>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f139eeee310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f139eff6790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f12afa00a90>
    │    └ <base.db.dbSlot.Slot object at 0x7f12afa00ac0>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2276908560466166454956406714...
    │   └ <function Query.update at 0x7f139f1343a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f12ac590c70>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f139f110af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f12ac590ac0>
             └ <sqlalchemy.orm.query.Query object at 0x7f12ac590c70>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12ac58e2b0>
             │    └ <function Connection._execute_20 at 0x7f139f3bd790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f12ac590a90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f12ac590a90>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12ac58e2b0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f139f3bd5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f12ac590a90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f139f3bd8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f12ac590a90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f139f3bda60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ac590a90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f139f77da60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ac590a90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2276908560466166454956406714...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ac58e310>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2276908560466166454956...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ac58e310>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2276908560466166454956...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12afa0bf10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12ac5904c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12ac5904c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ac57c880>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ac57c880>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '22769085604661664549564067141059883984864902928223949021358717239345814611971940833822245113040758074401644666584313699773330935784482044093952479100 ... (10 characters truncated) ... 73853993909913713638685143317550854242831975680145082218367574750819501565568532083007323008969194204790590792731882889988203096213937890213744503700', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:48:18.165 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ac57c400>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3846982258214740378417819738...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ac565fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3846982258214740378417...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ac565fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3846982258214740378417...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12ac561910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12ac561910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ac531be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ac531be0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f13c792aa60>
    └ <Thread(Thread-31, started daemon 139717685270272)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f13c792a790>
    └ <Thread(Thread-31, started daemon 139717685270272)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-31, started daemon 139717685270272)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-31, started daemon 139717685270272)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f12afce7460>>
    └ <Thread(Thread-31, started daemon 139717685270272)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f12afa08280>
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    └ <function Project.update_device_valid at 0x7f12afa06280>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f139eeee310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f139eff6790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f12afa00a90>
    │    └ <base.db.dbSlot.Slot object at 0x7f12afa00ac0>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3846982258214740378417819738...
    │   └ <function Query.update at 0x7f139f1343a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f12ac57cac0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f139f110af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f12ac561b20>
             └ <sqlalchemy.orm.query.Query object at 0x7f12ac57cac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12ac565070>
             │    └ <function Connection._execute_20 at 0x7f139f3bd790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f12ac57c400>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f12ac57c400>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12ac565070>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f139f3bd5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f12ac57c400>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f139f3bd8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f12ac57c400>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f139f3bda60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ac57c400>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f139f77da60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12ac57c400>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3846982258214740378417819738...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ac565fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3846982258214740378417...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ac565fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3846982258214740378417...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12ac561910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12ac561910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ac531be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ac531be0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '38469822582147403784178197387128702519425604104404249748293210286457553241299599880780584986385854694060250584275555051118315489544821952309525335979 ... (9 characters truncated) ... 67325350686927224716397041341403793160463791974344974979835742714287532500362894160293019539691676081131563759905074313536167505831023137291427102425', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:48:36.168 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12af89bf70>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3845721305616932993077688875...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ac54d790>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3845721305616932993077...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ac54d790>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3845721305616932993077...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12af8802b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12af8802b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ac58eee0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ac58eee0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f13c792aa60>
    └ <Thread(Thread-36, started daemon 139717668484864)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f13c792a790>
    └ <Thread(Thread-36, started daemon 139717668484864)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-36, started daemon 139717668484864)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-36, started daemon 139717668484864)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f12afce7460>>
    └ <Thread(Thread-36, started daemon 139717668484864)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f12afa08280>
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f12afce7460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    └ <function Project.update_device_valid at 0x7f12afa06280>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f139eeee310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f12afa2b2b0>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f139eff6790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f12afa00a90>
    │    └ <base.db.dbSlot.Slot object at 0x7f12afa00ac0>
    └ <monitor.projectManager.Project object at 0x7f12afa2b790>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3845721305616932993077688875...
    │   └ <function Query.update at 0x7f139f1343a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f12ac57cbe0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f139f110af0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f12af91b610>
             └ <sqlalchemy.orm.query.Query object at 0x7f12ac57cbe0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12ac54d070>
             │    └ <function Connection._execute_20 at 0x7f139f3bd790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f12af89bf70>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f12af89bf70>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f12ac54d070>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f139f3bd5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f12af89bf70>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f139f3bd8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f12af89bf70>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f139f3bda60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12af89bf70>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f139f77da60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f139f2f85e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f12afa00d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7f12af89bf70>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3845721305616932993077688875...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f139ef4ddc0>
    └ <pymysql.cursors.Cursor object at 0x7f12ac54d790>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3845721305616932993077...
             │    └ <function Cursor._query at 0x7f139eed8280>
             └ <pymysql.cursors.Cursor object at 0x7f12ac54d790>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3845721305616932993077...
    │    └ <function Connection.query at 0x7f139eee6670>
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f139eee6ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f12acd9eac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f139eee74c0>
    └ <pymysql.connections.MySQLResult object at 0x7f12af8802b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f12af8802b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f139eedeee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f12ac58eee0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f12ac58eee0>
    │   └ <function raise_mysql_exception at 0x7f139ef8d670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '38457213056169329930776888751039228201106158787766433881636656998283063929704507805542364658441348527100495009802675477522317793591537800223830478258 ... (10 characters truncated) ... 98627592986509784946495180542068107365831432974071076178238041654498383034514823013804766346159275373665544052341466337824895404217682464580700691358', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
