2022-05-14 08:44:35.158 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30186a04c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1240147414882693545441514988...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2fd813a580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1240147414882693545441...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2fd813a580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1240147414882693545441...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30181bae20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30181bae20>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30181bae20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2fb867eca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2fb867eca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de9b56fd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de9b56fd0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14444, started daemon 139840712275712)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14444, started daemon 139840712275712)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14444, started daemon 139840712275712)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14444, started daemon 139840712275712)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14444, started daemon 139840712275712)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1240147414882693545441514988...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f30186a0a00>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f30186a0580>
             └ <sqlalchemy.orm.query.Query object at 0x7f30186a0a00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2fd813a130>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f30186a04c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f30186a04c0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2fd813a130>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f30186a04c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f30186a04c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30186a04c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30186a04c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1240147414882693545441514988...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2fd813a580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1240147414882693545441...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2fd813a580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1240147414882693545441...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30181bae20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30181bae20>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30181bae20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2fb867eca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2fb867eca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de9b56fd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de9b56fd0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '12401474148826935454415149889093608154032982368028236188707921925337629674191563028905932300348274252376592553577393429727698180076853587988280546690 ... (10 characters truncated) ... 19116034926088422657423536610885936766761917405340512849395518567835071936288946953668702567646021147629016654591112568940011636046768980305792752539', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:44:52.724 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f9843e460>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8944297779693484697870878833...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f31023c5ac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8944297779693484697870...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f31023c5ac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8944297779693484697870...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2fb8323eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2fb8323eb0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2fb8323eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2e11aff820>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2e11aff820>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de9998c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de9998c70>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14448, started daemon 139840661919488)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14448, started daemon 139840661919488)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14448, started daemon 139840661919488)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14448, started daemon 139840661919488)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14448, started daemon 139840661919488)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8944297779693484697870878833...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2f9843e640>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2f9843e850>
             └ <sqlalchemy.orm.query.Query object at 0x7f2f9843e640>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f31023c5ca0>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2f9843e460>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2f9843e460>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f31023c5ca0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2f9843e460>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2f9843e460>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f9843e460>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f9843e460>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8944297779693484697870878833...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f31023c5ac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8944297779693484697870...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f31023c5ac0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8944297779693484697870...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2fb8323eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2fb8323eb0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2fb8323eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2e11aff820>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2e11aff820>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de9998c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de9998c70>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '89442977796934846978708788337598304554068629000296771812702694074341586959471726114331882015592890682276631645467601524093441558776233221764599911690 ... (10 characters truncated) ... 37134080856193481525889761719741854491735593225410417661922956935387244543296590449301190948911972518405347301988013619836279148355782927416276928068', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:45:10.822 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb868f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8334294358206535065265545006...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2ff8519be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8334294358206535065265...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2ff8519be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8334294358206535065265...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30583e77c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30583e77c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30583e77c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f3078287820>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f3078287820>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2f78795340>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2f78795340>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14453, started daemon 139840636741376)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14453, started daemon 139840636741376)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14453, started daemon 139840636741376)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14453, started daemon 139840636741376)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14453, started daemon 139840636741376)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8334294358206535065265545006...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2f985972e0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f3058624d60>
             └ <sqlalchemy.orm.query.Query object at 0x7f2f985972e0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30585e0310>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2fb868f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb868f0a0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30585e0310>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2fb868f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2fb868f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb868f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb868f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8334294358206535065265545006...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2ff8519be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8334294358206535065265...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2ff8519be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8334294358206535065265...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30583e77c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30583e77c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30583e77c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f3078287820>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f3078287820>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2f78795340>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2f78795340>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '83342943582065350652655450062368157509428956605919024484123755083668470527024882885646515386662446273122641667934130705917073025571464421485699894197 ... (10 characters truncated) ... 23843105929180111887520446880029204726920977557725602911505259183944912637984106192500067669082825485827293406465056077287811881395358552917865053586', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:45:29.410 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f31f937e6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3073819192820290934149288073...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30384eadc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3073819192820290934149...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30384eadc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3073819192820290934149...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f31f9151cd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f31f9151cd0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f31f9151cd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2fb82c0070>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2fb82c0070>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f303845adc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f303845adc0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14458, started daemon 139840645134080)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14458, started daemon 139840645134080)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14458, started daemon 139840645134080)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14458, started daemon 139840645134080)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14458, started daemon 139840645134080)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3073819192820290934149288073...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f31f9151a90>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2e12bd55e0>
             └ <sqlalchemy.orm.query.Query object at 0x7f31f9151a90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2e12bb5cd0>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f31f937e6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f31f937e6d0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2e12bb5cd0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f31f937e6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f31f937e6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f31f937e6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f31f937e6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3073819192820290934149288073...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30384eadc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3073819192820290934149...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30384eadc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3073819192820290934149...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f31f9151cd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f31f9151cd0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f31f9151cd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2fb82c0070>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2fb82c0070>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f303845adc0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f303845adc0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '30738191928202909341492880731126232489745355312799227720758563776668524086986878105795057149116753845984910070551868312254836024811049216414768938907 ... (10 characters truncated) ... 80658679488932090463159007840976329038191838048182610355076186073491475871344273568935920267113372278686023036161526073669397805244346174313102665250', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:45:47.343 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3058306e50>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7809147450139316465275186399...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2de99ecc40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7809147450139316465275...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2de99ecc40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7809147450139316465275...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30b85450a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30b85450a0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30b85450a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2de9c84c10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2de9c84c10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2fb8329c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2fb8329c70>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14463, started daemon 139840611563264)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14463, started daemon 139840611563264)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14463, started daemon 139840611563264)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14463, started daemon 139840611563264)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14463, started daemon 139840611563264)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7809147450139316465275186399...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f307828eeb0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f30981bf0a0>
             └ <sqlalchemy.orm.query.Query object at 0x7f307828eeb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30b87bb190>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f3058306e50>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f3058306e50>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30b87bb190>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f3058306e50>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f3058306e50>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3058306e50>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f3058306e50>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7809147450139316465275186399...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2de99ecc40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7809147450139316465275...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2de99ecc40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7809147450139316465275...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f30b85450a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f30b85450a0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f30b85450a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2de9c84c10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2de9c84c10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2fb8329c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2fb8329c70>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '78091474501393164652751863997708672159281413874692134569075165282352251478632541526405502093639446809362434449704086204979391710354678975921579392855 ... (10 characters truncated) ... 55873124979044148291574755237887034611811727230109269408624760655797360722779501634492198819930849645111795732977200242719894051575062434995169573078', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:46:05.382 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9e17a00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1640988001279956012188967068...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2e05fede20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1640988001279956012188...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2e05fede20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1640988001279956012188...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f31f91b8790>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f31f91b8790>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f31f91b8790>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30981ab730>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30981ab730>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30b80fd100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30b80fd100>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14467, started daemon 139840678704896)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14467, started daemon 139840678704896)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14467, started daemon 139840678704896)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14467, started daemon 139840678704896)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14467, started daemon 139840678704896)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1640988001279956012188967068...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2f982b91f0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f309854bb50>
             └ <sqlalchemy.orm.query.Query object at 0x7f2f982b91f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30b861c8b0>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2de9e17a00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9e17a00>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30b861c8b0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2de9e17a00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2de9e17a00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9e17a00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2de9e17a00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1640988001279956012188967068...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2e05fede20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1640988001279956012188...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2e05fede20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1640988001279956012188...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f31f91b8790>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f31f91b8790>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f31f91b8790>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30981ab730>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30981ab730>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30b80fd100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30b80fd100>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '16409880012799560121889670688167704254242803136166690245307632877977108528293529939876585157108708749026901559803156197181815929862024842782644226221 ... (10 characters truncated) ... 96380047878019469353901904595527569423787838637950577112448718387566480825473802158998107580123078747522880349080535795550313095199160905937635088335', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:46:22.981 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2dea05c5b0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '6648045356074077232773339076...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30184ed520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='6648045356074077232773...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30184ed520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='6648045356074077232773...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2dea05c7c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2dea05c7c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2dea05c7c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2de9d81610>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2de9d81610>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2f781b6d90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2f781b6d90>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14471, started daemon 139840569599744)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14471, started daemon 139840569599744)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14471, started daemon 139840569599744)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14471, started daemon 139840569599744)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14471, started daemon 139840569599744)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '6648045356074077232773339076...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2f7863ef40>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2f7863e5e0>
             └ <sqlalchemy.orm.query.Query object at 0x7f2f7863ef40>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30184ed1c0>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2dea05c5b0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2dea05c5b0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f30184ed1c0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2dea05c5b0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2dea05c5b0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2dea05c5b0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2dea05c5b0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '6648045356074077232773339076...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f30184ed520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='6648045356074077232773...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f30184ed520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='6648045356074077232773...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2dea05c7c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2dea05c7c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2dea05c7c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f2de9d81610>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f2de9d81610>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2f781b6d90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2f781b6d90>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '66480453560740772327733390761106950174922864676156626988269473358034978731099778355756172071594129626912247064746794658957417250122417009546896488765 ... (10 characters truncated) ... 07013237546215823468243989171131694644531029617139450913587846711888047015552814478179348785077651937006644877730489497711789784362195729160101142254', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:46:41.740 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30383d11f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7808931047813150448358770037...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2fb85f27c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7808931047813150448358...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2fb85f27c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7808931047813150448358...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f3101c8b070>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f3101c8b070>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f3101c8b070>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f301840ae50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f301840ae50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de995b160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de995b160>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14476, started daemon 139840544421632)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14476, started daemon 139840544421632)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14476, started daemon 139840544421632)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14476, started daemon 139840544421632)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14476, started daemon 139840544421632)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7808931047813150448358770037...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2f9845b9a0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f30b83d8b80>
             └ <sqlalchemy.orm.query.Query object at 0x7f2f9845b9a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2de9bce610>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f30383d11f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f30383d11f0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2de9bce610>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f30383d11f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f30383d11f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30383d11f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30383d11f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7808931047813150448358770037...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2fb85f27c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7808931047813150448358...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2fb85f27c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7808931047813150448358...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f3101c8b070>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f3101c8b070>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f3101c8b070>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f301840ae50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f301840ae50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2de995b160>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2de995b160>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '78089310478131504483587700375449973212952717722054363244869670603578434684342664194865095820957268228973207872194692663153461665761415546916411790729 ... (10 characters truncated) ... 04940676333261140933402809286723612712934001299460132682512375157888475075229565576220437385476592772030654202964365460148965794559034561434599991187', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:46:59.162 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb83b9d90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8509635989905130341385322238...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2de9bb0b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8509635989905130341385...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2de9bb0b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8509635989905130341385...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f31f91b87c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f31f91b87c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f31f91b87c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30986abf40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30986abf40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f3078734610>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f3078734610>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14481, started daemon 139840552814336)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14481, started daemon 139840552814336)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14481, started daemon 139840552814336)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14481, started daemon 139840552814336)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14481, started daemon 139840552814336)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8509635989905130341385322238...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2fb83b98e0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f303814f4c0>
             └ <sqlalchemy.orm.query.Query object at 0x7f2fb83b98e0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2de9bb0520>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2fb83b9d90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb83b9d90>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2de9bb0520>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2fb83b9d90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2fb83b9d90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb83b9d90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2fb83b9d90>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8509635989905130341385322238...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f2de9bb0b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8509635989905130341385...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f2de9bb0b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8509635989905130341385...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f31f91b87c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f31f91b87c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f31f91b87c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f30986abf40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f30986abf40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f3078734610>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f3078734610>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '85096359899051303413853222381978740289890292139642791009053983976812270167677374825502815325168080967078833728141584871218468535155810645289706239673 ... (10 characters truncated) ... 42780327195920628720565119795665578095042018345937685927850680320643468554892519970764162538249602069750840322160381519446505312332908836605678905866', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:47:16.923 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f7866e4c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8633506965102316235791067723...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f31000375b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8633506965102316235791...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f31000375b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8633506965102316235791...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f309821b910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f309821b910>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f309821b910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f307831e520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f307831e520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2e12bb56d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2e12bb56d0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14486, started daemon 139840519243520)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14486, started daemon 139840519243520)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14486, started daemon 139840519243520)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14486, started daemon 139840519243520)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14486, started daemon 139840519243520)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8633506965102316235791067723...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f3058211a00>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2f7817f760>
             └ <sqlalchemy.orm.query.Query object at 0x7f3058211a00>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f3101be0ca0>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2f7866e4c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2f7866e4c0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f3101be0ca0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2f7866e4c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2f7866e4c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f7866e4c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f7866e4c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '8633506965102316235791067723...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f31000375b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8633506965102316235791...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f31000375b0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='8633506965102316235791...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f309821b910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f309821b910>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f309821b910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f307831e520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f307831e520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2e12bb56d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2e12bb56d0>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '86335069651023162357910677238539284936789040370018879402858474936570591064239556668322795337690472942461991998031756755076922157484830638515791578332 ... (10 characters truncated) ... 36891434843667725961301623231888700782396756498573454488663570844648540569309651283386095671094801868630927249798161327176599158786360599335137297373', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:47:35.718 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30b861c6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9839756994703074119934968893...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f309851dc70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9839756994703074119934...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f309851dc70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9839756994703074119934...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f784a0b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f784a0b20>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f784a0b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f309854b640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f309854b640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30985bc640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30985bc640>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14490, started daemon 139840485672704)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14490, started daemon 139840485672704)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14490, started daemon 139840485672704)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14490, started daemon 139840485672704)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14490, started daemon 139840485672704)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9839756994703074119934968893...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2de9bc6c70>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f30180fcf40>
             └ <sqlalchemy.orm.query.Query object at 0x7f2de9bc6c70>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f309851d790>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f30b861c6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f30b861c6d0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f309851d790>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f30b861c6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f30b861c6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30b861c6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f30b861c6d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9839756994703074119934968893...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f309851dc70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9839756994703074119934...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f309851dc70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9839756994703074119934...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f784a0b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f784a0b20>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f784a0b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f309854b640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f309854b640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f30985bc640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f30985bc640>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '98397569947030741199349688930720540432488048236611508871711648234207001014245295486075362784640572748219163984530041677934291543951118775853179986203 ... (10 characters truncated) ... 47252409749746486293892675246146782169521212154422441328312542177112839148885759813116891542543655158999854322193823192083219422829164444757216882994', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-14 08:47:54.169 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f98464eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2153646168423371704270595153...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f309878b520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2153646168423371704270...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f309878b520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2153646168423371704270...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f98464310>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f98464310>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f98464310>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f3101d6efd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f3101d6efd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2ff85d7580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2ff85d7580>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7f321bf29a60>
    └ <Thread(Thread-14494, started daemon 139840577992448)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7f321bf29790>
    └ <Thread(Thread-14494, started daemon 139840577992448)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-14494, started daemon 139840577992448)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-14494, started daemon 139840577992448)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>>
    └ <Thread(Thread-14494, started daemon 139840577992448)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7f3104005280>
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7f31042e52e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    └ <function Project.update_device_valid at 0x7f3104003280>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7f31f34ed310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7f3104029220>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7f31f35f4790>
    │    │                └ <base.db.mysql.Mysql object at 0x7f3103ffdfd0>
    │    └ <base.db.dbSlot.Slot object at 0x7f3103ffdf10>
    └ <monitor.projectManager.Project object at 0x7f3104029460>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2153646168423371704270595153...
    │   └ <function Query.update at 0x7f31f37333a0>
    └ <sqlalchemy.orm.query.Query object at 0x7f2f98464e80>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7f31f370faf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7f2f98464400>
             └ <sqlalchemy.orm.query.Query object at 0x7f2f98464e80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2e06001550>
             │    └ <function Connection._execute_20 at 0x7f31f39bc790>
             └ <sqlalchemy.engine.base.Connection object at 0x7f2f98464eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7f2f98464eb0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7f2e06001550>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7f31f39bc5e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7f2f98464eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7f31f39bc8b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7f2f98464eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7f31f39bca60>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f98464eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7f31f3d7ea60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7f31f38f75e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7f3103ffde20>
    └ <sqlalchemy.engine.base.Connection object at 0x7f2f98464eb0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2153646168423371704270595153...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7f31f354cdc0>
    └ <pymysql.cursors.Cursor object at 0x7f309878b520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2153646168423371704270...
             │    └ <function Cursor._query at 0x7f31f34d7280>
             └ <pymysql.cursors.Cursor object at 0x7f309878b520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2153646168423371704270...
    │    └ <function Connection.query at 0x7f31f34e5670>
    └ <pymysql.connections.Connection object at 0x7f2f98464310>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7f31f34e5ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7f2f98464310>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7f2f98464310>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7f31f34e64c0>
    └ <pymysql.connections.MySQLResult object at 0x7f3101d6efd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7f3101d6efd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7f31f34ddee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7f2ff85d7580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7f2ff85d7580>
    │   └ <function raise_mysql_exception at 0x7f31f358c670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '21536461684233717042705951532712105213731194234204528344275450328628386596926032336668788120184724899575416229771415151167812229394102617492537354069 ... (10 characters truncated) ... 39747297591746464487240608809952748059729515758779936127055483504046348777186054255865536558579364170710575648972287431643014993369937175714132871889', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
