2022-05-13 16:34:06.265 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa1607b4fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7903070002986765416459610533...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa142f49a00>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7903070002986765416459...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa142f49a00>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7903070002986765416459...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160581fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160581fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa1603cbd00>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa1603cbd00>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-711, started daemon 140328954734336)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-711, started daemon 140328954734336)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-711, started daemon 140328954734336)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-711, started daemon 140328954734336)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-711, started daemon 140328954734336)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7903070002986765416459610533...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa142df72b0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa1603de160>
             └ <sqlalchemy.orm.query.Query object at 0x7fa142df72b0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa16028ed60>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa1607b4fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa1607b4fa0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa16028ed60>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa1607b4fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa1607b4fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa1607b4fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa1607b4fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7903070002986765416459610533...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa142f49a00>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7903070002986765416459...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa142f49a00>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7903070002986765416459...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160581fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160581fa0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa1603cbd00>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa1603cbd00>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '79030700029867654164596105334762368039963901460905338555502691239267178719990026972029568380302192129541594734724198365159696781874546155674748366066 ... (9 characters truncated) ... 98605171579499018851993274832910348238744906833545395765480805643576314747265544517994589859172256259253387391712277486741522535911138341341704323453', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:34:11.005 | ERROR    | base.utils.time:people_time_from_url:173 - 【url error】url:http://bbs1.people.com.cn/post/1/1/2/177707142.html
2022-05-13 16:34:11.604 | ERROR    | base.utils.time:people_time_from_url:173 - 【url error】url:http://bbs1.people.com.cn/post/1/1/2/177707142.html
2022-05-13 16:34:24.262 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa160885dc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2833290896345520569444526243...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa14218ae80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2833290896345520569444...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa14218ae80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2833290896345520569444...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160249fd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160249fd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160109640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160109640>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-716, started daemon 140328459826944)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-716, started daemon 140328459826944)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-716, started daemon 140328459826944)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-716, started daemon 140328459826944)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-716, started daemon 140328459826944)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2833290896345520569444526243...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa1605226d0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa160522a30>
             └ <sqlalchemy.orm.query.Query object at 0x7fa1605226d0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa14218a340>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa160885dc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa160885dc0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa14218a340>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa160885dc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa160885dc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa160885dc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa160885dc0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '2833290896345520569444526243...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa14218ae80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2833290896345520569444...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa14218ae80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='2833290896345520569444...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa258c2ee50>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160249fd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160249fd0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160109640>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160109640>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '28332908963455205694445262430223517548091130540850765200480191017782237318626448628581390169559118567232746840994051205611488451990256205573535380176 ... (10 characters truncated) ... 14153991605692258931966484040336734192861443642975651784711136080097225576854633961450370989776224288013377849831247856539140042600966435067863828159', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:34:27.820 | ERROR    | base.utils.time:people_time_from_url:173 - 【url error】url:http://bbs1.people.com.cn/post/2/1/2/177698723.html
2022-05-13 16:34:28.347 | ERROR    | base.utils.time:people_time_from_url:173 - 【url error】url:http://bbs1.people.com.cn/post/2/1/2/177698723.html
2022-05-13 16:34:36.223 | ERROR    | base.utils.time:people_time_from_url:173 - 【url error】url:http://bbs1.people.com.cn/post/2/1/2/177707041.html
2022-05-13 16:34:36.741 | ERROR    | base.utils.time:people_time_from_url:173 - 【url error】url:http://bbs1.people.com.cn/post/2/1/2/177707041.html
2022-05-13 16:34:42.274 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa161daa430>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3578863353167306106635445608...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa1609591f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3578863353167306106635...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa1609591f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3578863353167306106635...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa16097d700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa16097d700>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa16097d700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa1421a5bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa1421a5bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa1600e39d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa1600e39d0>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-721, started daemon 140328946341632)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-721, started daemon 140328946341632)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-721, started daemon 140328946341632)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-721, started daemon 140328946341632)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-721, started daemon 140328946341632)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3578863353167306106635445608...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa1608e1340>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa142d5b370>
             └ <sqlalchemy.orm.query.Query object at 0x7fa1608e1340>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160959f40>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa161daa430>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa161daa430>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160959f40>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa161daa430>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa161daa430>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa161daa430>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa161daa430>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3578863353167306106635445608...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa1609591f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3578863353167306106635...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa1609591f0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3578863353167306106635...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa16097d700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa16097d700>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa16097d700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa1421a5bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa1421a5bb0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa1600e39d0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa1600e39d0>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '35788633531673061066354456085892403310406670055050131049405918940444145453836758499074255524334546159522707597212944412127240466124653120035745537899 ... (10 characters truncated) ... 72555485384908981025518063350281188028542445023073918799265256078301275617310001690857351943003839469328885835659398567220584637795956939309539503774', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:35:00.236 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa142e23910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5905551101730290959478716181...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa1608d0ca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5905551101730290959478...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa1608d0ca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5905551101730290959478...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa142d516a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa142d516a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160754f10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160754f10>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-725, started daemon 140328451434240)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-725, started daemon 140328451434240)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-725, started daemon 140328451434240)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-725, started daemon 140328451434240)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-725, started daemon 140328451434240)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5905551101730290959478716181...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa160587f40>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa1601ba580>
             └ <sqlalchemy.orm.query.Query object at 0x7fa160587f40>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160240070>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa142e23910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa142e23910>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160240070>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa142e23910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa142e23910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa142e23910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa142e23910>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5905551101730290959478716181...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa1608d0ca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5905551101730290959478...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa1608d0ca0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5905551101730290959478...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa142d516a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa142d516a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160754f10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160754f10>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '59055511017302909594787161817927668844732020138291574903034361316582714632479606793521282851745015321580919322526183551666259003533499870627616901947 ... (10 characters truncated) ... 27819520642214738278215398327000943295887875509283616147510723059704213932333463165589424996406008524322471470639192555926663942835582472870042295000', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:35:18.313 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa16099cca0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7968310601439004706686853688...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160a05850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7968310601439004706686...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160a05850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7968310601439004706686...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160253e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160253e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa1603b02e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa1603b02e0>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-730, started daemon 140328443041536)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-730, started daemon 140328443041536)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-730, started daemon 140328443041536)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-730, started daemon 140328443041536)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-730, started daemon 140328443041536)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7968310601439004706686853688...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa1605c9ac0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa1605c9d60>
             └ <sqlalchemy.orm.query.Query object at 0x7fa1605c9ac0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160126190>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa16099cca0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa16099cca0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160126190>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa16099cca0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa16099cca0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa16099cca0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa16099cca0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7968310601439004706686853688...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160a05850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7968310601439004706686...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160a05850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7968310601439004706686...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa1606e94c0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160253e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160253e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa1603b02e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa1603b02e0>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '79683106014390047066868536886649454747012414372671669628194994857915305414488824138937807288113428403110657019510013869537537699354907432744151627622 ... (10 characters truncated) ... 84758795212800108607905556854696632166504537022718040795988235370280503882746050709187020495407090156842277472618616563881734389992707414734766919358', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:35:36.245 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa258c3b820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '6053562618866220586609197846...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160aa2040>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='6053562618866220586609...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160aa2040>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='6053562618866220586609...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa16097d700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa16097d700>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa16097d700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160a05f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160a05f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160566e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160566e80>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-734, started daemon 140328434648832)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-734, started daemon 140328434648832)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-734, started daemon 140328434648832)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-734, started daemon 140328434648832)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-734, started daemon 140328434648832)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '6053562618866220586609197846...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa1609df4f0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa142e68f40>
             └ <sqlalchemy.orm.query.Query object at 0x7fa1609df4f0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa16004ac40>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa258c3b820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa258c3b820>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa16004ac40>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa258c3b820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa258c3b820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa258c3b820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa258c3b820>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '6053562618866220586609197846...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160aa2040>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='6053562618866220586609...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160aa2040>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='6053562618866220586609...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa16097d700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa16097d700>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa16097d700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160a05f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160a05f40>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160566e80>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160566e80>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '60535626188662205866091978467736083852229800204969677243652533465055357096586585190555068227120204007550490156851935617774423670677543396644766198098 ... (10 characters truncated) ... 62025123807058613711049651561803493806521369316977205361793582241696317258577292604923927033193918858701947729206285831411603729287063928813430480044', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:35:54.280 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa161cf5b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5792495447102011004197800174...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160724be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5792495447102011004197...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160724be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5792495447102011004197...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa142e14880>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa142e14880>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa142e14880>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160894580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160894580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa142cf0df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa142cf0df0>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-739, started daemon 140328417863424)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-739, started daemon 140328417863424)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-739, started daemon 140328417863424)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-739, started daemon 140328417863424)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-739, started daemon 140328417863424)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5792495447102011004197800174...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa161cf50a0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa1604703d0>
             └ <sqlalchemy.orm.query.Query object at 0x7fa161cf50a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160724730>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa161cf5b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa161cf5b80>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160724730>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa161cf5b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa161cf5b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa161cf5b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa161cf5b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '5792495447102011004197800174...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160724be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5792495447102011004197...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160724be0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='5792495447102011004197...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa142e14880>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa142e14880>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa142e14880>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa160894580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa160894580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa142cf0df0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa142cf0df0>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '57924954471020110041978001741566068920579805541644749246370792671539608391862103369332077596029711465380061614262477020349956889808922922182175565588 ... (10 characters truncated) ... 82124913251327684444419453623574347475861487262428136335476506346065429200519175323466416739807977788524357214343297019424162365926670884549636150921', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:36:12.287 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa160a414c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3469733190282310004379251553...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160552550>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3469733190282310004379...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160552550>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3469733190282310004379...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa160a41c70>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa16099c0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa16099c0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa1607b4370>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa1607b4370>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-744, started daemon 140328426256128)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-744, started daemon 140328426256128)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-744, started daemon 140328426256128)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-744, started daemon 140328426256128)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-744, started daemon 140328426256128)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3469733190282310004379251553...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa160966280>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa160966eb0>
             └ <sqlalchemy.orm.query.Query object at 0x7fa160966280>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa1605527f0>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa160a414c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa160a414c0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa1605527f0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa160a414c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa160a414c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa160a414c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa160a414c0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '3469733190282310004379251553...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160552550>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3469733190282310004379...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160552550>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='3469733190282310004379...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa160a41c70>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa16099c0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa16099c0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa1607b4370>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa1607b4370>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '34697331902823100043792515530619264302513877036043649608646786977695452982500425213445118383787467283870041340499465891669877450705067852249573426880 ... (10 characters truncated) ... 12208931597654179841119761017861491936832600065721345010352644441825367793047043464715360826535481606277002556709402716935285145199649109458547195374', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:36:30.260 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa1421c4730>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7758468421406125236120637306...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa1421c4700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7758468421406125236120...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa1421c4700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7758468421406125236120...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa1608662e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa1608662e0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa1608662e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa16073dd90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa16073dd90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160562190>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160562190>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-748, started daemon 140328409470720)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-748, started daemon 140328409470720)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-748, started daemon 140328409470720)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-748, started daemon 140328409470720)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-748, started daemon 140328409470720)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7758468421406125236120637306...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa1603fb730>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa160210790>
             └ <sqlalchemy.orm.query.Query object at 0x7fa1603fb730>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa1605c7b20>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa1421c4730>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa1421c4730>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa1605c7b20>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa1421c4730>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa1421c4730>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa1421c4730>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa1421c4730>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '7758468421406125236120637306...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa1421c4700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7758468421406125236120...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa1421c4700>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='7758468421406125236120...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa1608662e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa1608662e0>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa1608662e0>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa16073dd90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa16073dd90>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160562190>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160562190>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '77584684214061252361206373062415918998527380653187219696061542763900569642174478024160726138162569254658661853788238498869517708965220816348054451207 ... (10 characters truncated) ... 94004419350080223284246861524662832172837309902279327002166481689427185353929951180816654271338010017894305531581102983232129488047346266601972763956', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:36:48.286 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa16055f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1970857455711322156611753073...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160b00850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1970857455711322156611...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160b00850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1970857455711322156611...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa160a41c70>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa16055f190>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa16055f190>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160aa7c10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160aa7c10>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-753, started daemon 140327914563328)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-753, started daemon 140327914563328)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-753, started daemon 140327914563328)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-753, started daemon 140327914563328)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-753, started daemon 140327914563328)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1970857455711322156611753073...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa16055fcd0>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa16055f4f0>
             └ <sqlalchemy.orm.query.Query object at 0x7fa16055fcd0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160b00340>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa16055f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa16055f0a0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160b00340>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa16055f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa16055f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa16055f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa16055f0a0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '1970857455711322156611753073...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa160b00850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1970857455711322156611...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa160b00850>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='1970857455711322156611...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa160a41c70>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa16055f190>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa16055f190>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160aa7c10>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160aa7c10>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '19708574557113221566117530730313415923861504124601395783318429271870701606340466866560862642471503287552867307322864966180455137461682472437955938470 ... (10 characters truncated) ... 53427883432167125518257329771301144166549448484354117491713942182902216397410305532843052994173483590380583670107663946834970205869394722434886464791', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:37:06.315 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa258c4dbe0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9365762220637097966694646632...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa1421c1580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9365762220637097966694...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa1421c1580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9365762220637097966694...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa160a41c70>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa1607b4b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa1607b4b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa258c4d910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa258c4d910>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-757, started daemon 140327922956032)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-757, started daemon 140327922956032)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-757, started daemon 140327922956032)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-757, started daemon 140327922956032)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-757, started daemon 140327922956032)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9365762220637097966694646632...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa160738280>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa142f95310>
             └ <sqlalchemy.orm.query.Query object at 0x7fa160738280>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160722ee0>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa258c4dbe0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa258c4dbe0>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa160722ee0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa258c4dbe0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa258c4dbe0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa258c4dbe0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa258c4dbe0>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9365762220637097966694646632...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa1421c1580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9365762220637097966694...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa1421c1580>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9365762220637097966694...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa160a41c70>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa160a41c70>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa1607b4b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa1607b4b20>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa258c4d910>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa258c4d910>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '93657622206370979666946466329098228156722248038055169547103684003082533830513007607717998226221513816760680778086686305653638459296377604127572450170 ... (10 characters truncated) ... 02363607079690913090532510913782722338041534992486734123092835606903789354383857095416074587122522893132288919360301717612837740106012649575322191602', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
2022-05-13 16:37:24.311 | ERROR    | base.db.mysql:update:390 - 【mysql更新数据出错】
Traceback (most recent call last):

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa142d20220>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9223313104330015859345482118...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa258c2e520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9223313104330015859345...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa258c2e520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9223313104330015859345...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa16087f130>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa16087f130>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa16087f130>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa14217e100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa14217e100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160a7d340>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160a7d340>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

pymysql.err.IntegrityError: (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/usr/lib/python3.8/threading.py", line 890, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7fa27b7e4a60>
    └ <Thread(Thread-762, started daemon 140327906170624)>
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7fa27b7e4790>
    └ <Thread(Thread-762, started daemon 140327906170624)>
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(Thread-762, started daemon 140327906170624)>
    │    │        │    └ ('ProjectManager.run_func_by_thread',)
    │    │        └ <Thread(Thread-762, started daemon 140327906170624)>
    │    └ <bound method ProjectManager.get_request_from_keywords_hot of <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>>
    └ <Thread(Thread-762, started daemon 140327906170624)>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 799, in get_request_from_keywords_hot
    self.start_finished_spider_every_interval(project_names)
    │    │                                    └ ['default', 'test']
    │    └ <function ProjectManager.start_finished_spider_every_interval at 0x7fa1638be280>
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 784, in start_finished_spider_every_interval
    self[name].start_spider()
    │    └ 'default'
    └ <monitor.projectManager.ProjectManager object at 0x7fa163b9f250>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 366, in start_spider
    self.update_device_valid(device)
    │    │                   └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    └ <function Project.update_device_valid at 0x7fa1638bc280>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

  File "/home/users/Scy/yuqing/spider/monitor/projectManager.py", line 421, in update_device_valid
    self.database_manager.mysql.update(Device(**device.to_item()))
    │    │                │     │      │        │      └ <function DeviceC.to_item at 0x7fa252daa310>
    │    │                │     │      │        └ <monitor.deviceManager.DeviceC object at 0x7fa1638c4730>
    │    │                │     │      └ <class 'base.db.mysql.Device'>
    │    │                │     └ <function Mysql.update at 0x7fa252eb1790>
    │    │                └ <base.db.mysql.Mysql object at 0x7fa1638b6f40>
    │    └ <base.db.dbSlot.Slot object at 0x7fa1638b6e80>
    └ <monitor.projectManager.Project object at 0x7fa1638c48e0>

> File "/home/users/Scy/yuqing/spider/base/db/mysql.py", line 375, in update
    row.update(new)
    │   │      └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9223313104330015859345482118...
    │   └ <function Query.update at 0x7fa252ff03a0>
    └ <sqlalchemy.orm.query.Query object at 0x7fa160721b80>

  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/query.py", line 3221, in update
    result = self.session.execute(
             │    │       └ <function Session.execute at 0x7fa252fccaf0>
             │    └ <sqlalchemy.orm.session.Session object at 0x7fa1606e09a0>
             └ <sqlalchemy.orm.query.Query object at 0x7fa160721b80>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/orm/session.py", line 1689, in execute
    result = conn._execute_20(statement, params or {}, execution_options)
             │    │           │          │             └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
             │    │           │          └ immutabledict({})
             │    │           └ <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa1421c4df0>
             │    └ <function Connection._execute_20 at 0x7fa253279790>
             └ <sqlalchemy.engine.base.Connection object at 0x7fa142d20220>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1583, in _execute_20
    return meth(self, args_10style, kwargs_10style, execution_options)
           │    │     │             │               └ immutabledict({'synchronize_session': 'evaluate', '_sa_orm_update_options': default_update_options(_matched_objects=[], _reso...
           │    │     │             └ immutabledict({})
           │    │     └ ({},)
           │    └ <sqlalchemy.engine.base.Connection object at 0x7fa142d20220>
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.annotation.AnnotatedUpdate object at 0x7fa1421c4df0>>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/sql/elements.py", line 323, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x7fa2532795e0>
           └ <sqlalchemy.engine.base.Connection object at 0x7fa142d20220>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1452, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x7fa2532798b0>
          └ <sqlalchemy.engine.base.Connection object at 0x7fa142d20220>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1814, in _execute_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x7fa253279a60>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa142d20220>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1995, in _handle_dbapi_exception
    util.raise_(
    │    └ <function raise_ at 0x7fa25363aa60>
    └ <module 'sqlalchemy.util' from '/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/__init__.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/util/compat.py", line 207, in raise_
    raise exception
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/base.py", line 1771, in _execute_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x7fa2531b45e0>
    │    └ <sqlalchemy.dialects.mysql.pymysql.MySQLDialect_pymysql object at 0x7fa1638b6d90>
    └ <sqlalchemy.engine.base.Connection object at 0x7fa142d20220>
  File "/home/chase/.local/lib/python3.8/site-packages/sqlalchemy/engine/default.py", line 717, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '9223313104330015859345482118...
    │      │       └ 'UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, por...
    │      └ <function Cursor.execute at 0x7fa252e09dc0>
    └ <pymysql.cursors.Cursor object at 0x7fa258c2e520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 148, in execute
    result = self._query(query)
             │    │      └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9223313104330015859345...
             │    └ <function Cursor._query at 0x7fa252d94280>
             └ <pymysql.cursors.Cursor object at 0x7fa258c2e520>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/cursors.py", line 310, in _query
    conn.query(q)
    │    │     └ "UPDATE device SET server_id='180.201.163.246:6800', ip='180.201.163.246', username='chase', password='9223313104330015859345...
    │    └ <function Connection.query at 0x7fa252da2670>
    └ <pymysql.connections.Connection object at 0x7fa16087f130>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 548, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
    │    │                │    │                             └ False
    │    │                │    └ <function Connection._read_query_result at 0x7fa252da2ca0>
    │    │                └ <pymysql.connections.Connection object at 0x7fa16087f130>
    │    └ 1
    └ <pymysql.connections.Connection object at 0x7fa16087f130>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 775, in _read_query_result
    result.read()
    │      └ <function MySQLResult.read at 0x7fa252da34c0>
    └ <pymysql.connections.MySQLResult object at 0x7fa14217e100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 1156, in read
    first_packet = self.connection._read_packet()
                   │    └ None
                   └ <pymysql.connections.MySQLResult object at 0x7fa14217e100>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/connections.py", line 725, in _read_packet
    packet.raise_for_error()
    │      └ <function MysqlPacket.raise_for_error at 0x7fa252d9aee0>
    └ <pymysql.protocol.MysqlPacket object at 0x7fa160a7d340>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/protocol.py", line 221, in raise_for_error
    err.raise_mysql_exception(self._data)
    │   │                     │    └ <member '_data' of 'MysqlPacket' objects>
    │   │                     └ <pymysql.protocol.MysqlPacket object at 0x7fa160a7d340>
    │   └ <function raise_mysql_exception at 0x7fa252e49670>
    └ <module 'pymysql.err' from '/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py'>
  File "/home/chase/.local/lib/python3.8/site-packages/pymysql/err.py", line 143, in raise_mysql_exception
    raise errorclass(errno, errval)
          │          │      └ "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'"
          │          └ 1062
          └ <class 'pymysql.err.IntegrityError'>

sqlalchemy.exc.IntegrityError: (pymysql.err.IntegrityError) (1062, "Duplicate entry '180.201.163.246:6800' for key 'device.PRIMARY'")
[SQL: UPDATE device SET server_id=%(server_id)s, ip=%(ip)s, username=%(username)s, password=%(password)s, address=%(address)s, port=%(port)s, valid=%(valid)s WHERE device.ip = %(ip_1)s]
[parameters: {'server_id': '180.201.163.246:6800', 'ip': '180.201.163.246', 'username': 'chase', 'password': '92233131043300158593454821184188900583860339729145549058794680127888870409061551918373574783439739741825618469786475795967844291459665151739382846394 ... (10 characters truncated) ... 42170609131633386860219237893162002519669264836575325178780479223357046330050267085273399197111365228451893364318131769423420352141255889356560668723', 'address': '/home/users/CT/pycharmproject/spiders/', 'port': 6800, 'valid': 1, 'ip_1': '180.201.163.246'}]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
